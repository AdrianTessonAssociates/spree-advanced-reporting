<% content_for :sidebar do -%>
  <%= render :partial => 'admin/reports/advanced_report_criteria', :locals => {} %>
<% end -%>

<h1><%= @report_name %></h1>
<p><%= @report.description %></p>
<%= @report.taxon_text %>
<%= @report.product_text %>

<div id="map_canvas"></div>    
<table width="100%" cellpadding="0" cellspacing="0" class="show_data">
  <tr>
    <td width="50%" class="selected" id="state">States</td>
    <td width="50%" id="country">Countries</td>
  </tr>
</table>

<% [:state, :country].each do |type| -%>
<div id="<%= type.to_s %>_data" <%= 'style="display:none;"' if type != :state %> class="advanced_reporting_data">
  <%= @report.ruportdata[type].to_html %>
  <div id="<%= type.to_s %>_canvas"></div>
</div>
<% end -%>

<% content_for :head do -%>
<script type='text/javascript'>
    google.setOnLoadCallback(drawMaps);

    function drawMaps() {
	<% [:state, :country].each do |type| -%>
    	var data_<%= type.to_s %> = new google.visualization.DataTable();
    	data_<%= type.to_s %>.addRows(<%= @report.ruportdata[type].size %>);
    	data_<%= type.to_s %>.addColumn('string', '<%= type.to_s.capitalize %>');
    	data_<%= type.to_s %>.addColumn('number', 'Revenue');
    	<% @report.ruportdata[type].each_with_index do |p, i| %>
    	data_<%= type.to_s %>.setValue(<%= i.to_s %>, 0, "<%= p.data[type.to_s.capitalize] %>");
    	data_<%= type.to_s %>.setValue(<%= i.to_s %>, 1, <%= p.data["Revenue"].to_s.gsub(/^\$/, '') %>);
    	<% end -%>

    	var options_<%= type.to_s %> = { 'width' : '800px', 'height' : '500px' };
        <% if type == :state %> 
    	options_<%= type.to_s %>['region'] = 'US';
        <% end -%>

    	var <%= type.to_s %>_container = document.getElementById('<%= type.to_s %>_canvas');
    	var <%= type.to_s %>_geomap = new google.visualization.GeoMap(<%= type.to_s %>_container);
    	<%= type.to_s %>_geomap.draw(data_<%= type.to_s %>, options_<%= type.to_s %>);
        <% end -%>
    };
</script>
<% end -%>
